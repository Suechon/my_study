## 送信側
1. アプリケーション層
* アプリケーション（例：ブラウザ）が送信データを生成（例：HTTPリクエスト）

1. トランスポート層
TCPヘッダを付ける
 → 送信元ポート番号（例：49200）・宛先ポート番号（例：80）などを設定

1. インターネット層（IP）
IPヘッダを付ける
 → 送信元IP: 192.168.1.10、宛先IP: 192.168.1.20

1. データリンク層（Ethernet）
ARPテーブルに宛先IPのMACアドレスがなければARPリクエスト送信
 → 宛先PCからARPリプライを受け取り、MACアドレス（BB:BB:BB:BB:BB:BB）を取得
 → Ethernetヘッダを付けてフレーム化
 → 宛先MAC: BB:BB:BB:BB:BB:BB、送信元MAC: AA:AA:AA:AA:AA:AA

1. 物理層
 フレームを電気信号に変換し、LANケーブル経由でスイッチへ送信

## 中継機器（スイッチ）の処理
1. 物理層
 PC_Aから届いた電気信号を受信

1. データリンク層（L2スイッチ）
フレームを読み取り、送信元MAC（AA:…）をMACアドレステーブルに学習
→ 宛先MAC（BB:…）の登録ポートがあれば、そのポートにフレームを転送
→ なければフラッディング（全ポートに転送）

## 受信側PC（PC_B）の処理
1. 物理層
スイッチから届いた電気信号を受信

1. データリンク層
フレームの宛先MACが自分（BB:…）と一致するため受け取る
→ Ethernetヘッダを取り除く

1. インターネット層（IP）
IPヘッダを確認
→ 宛先IPが自分（192.168.1.20）なので処理続行
→ IPヘッダを除去

1. トランスポート層（TCP）
ポート番号80を確認し、該当アプリケーション（Webサーバなど）へ渡す
→ TCPヘッダを除去

1. アプリケーション層
アプリケーション（例：Webサーバ）がHTTPリクエストを処理し、レスポンスを生成


### ARP
送信側PCが、送信先PCのMACアドレスがわからないことがある。
その時に、ARPを使うとわかる。
#### STEP
1. 送信元PCは、送信先MACアドレスがわからない(ARPテーブルに登録なし)
1. 送信元PCが、ARPリクエストを送る(宛先MACに ff:ff:ff:ff:ff:ff を設定)
1. スイッチが受信する(MACアドレスが全ビット1 → ブロードキャストと判断)
1. ** ブロードキャスト** :スイッチが全ポートに転送(受信ポートを除くすべてのポートにフレーム転送)
  * ポート: ポート番号ではない。スイッチ本体に物理的についているLANの差込口（物理ポート） のこと
1. 宛先IPを持つPCだけが応答(ARPリプライ（ユニキャスト）でMACアドレスを返す)

#### フレーム
* ARPリクエスト
┌───────────────────────────────────────────┐
│ Ethernetヘッダ（L2）                       │
│  ├─ 宛先MAC（6バイト）                      │ ← ff:ff:ff:ff:ff:ff（ブロードキャスト）
│  ├─ 送信元MAC（6バイト）                    │ ← PCのMACアドレス
│  └─ EtherType（2バイト）                    │ ← 0x0806（ARPを示す）
├────────────────────────────────────────────┤
│ ARPペイロード（L2データ部分）                │ ← ここが "ARPの本体"
│  ├─ ハードウェアタイプ（Ethernet=1）         │
│  ├─ プロトコルタイプ（IPv4=0x0800）          │
│  ├─ ハードウェア長（6）                      │
│  ├─ プロトコル長（4）                        │
│  ├─ オペレーション（1=リクエスト, 2=リプライ） │
│  ├─ 送信元MAC/IP 　　                       │
│  └─ 宛先MAC（または0） / 宛先IP　　          │
└────────────────────────────────────────────┘
* ARPリプライ
┌──────────────────────────────────────────┐
│ Ethernetヘッダ（L2）                      │
│  ├─ 宛先MAC       : AA:AA:AA:AA:AA:AA    │ ← PC_A 宛て（ARPを出してきた相手）
│  ├─ 送信元MAC     : BB:BB:BB:BB:BB:BB    │ ← PC_B 自身
│  └─ EtherType     : 0x0806               │ ← ARPを示す識別子
├──────────────────────────────────────────┤
│ ARPペイロード（L2データ部）                │
│  ├─ ハードウェアタイプ : 0x0001            │ ← Ethernet (固定)
│  ├─ プロトコルタイプ   : 0x0800           │ ← IPv4 (固定)
│  ├─ ハードウェア長     : 6                │ ← MACアドレスは6バイト
│  ├─ プロトコル長       : 4                 │ ← IPv4アドレスは4バイト
│  ├─ オペレーション     : 0x0002            │ ← ARPリプライ
│  ├─ 送信元MAC         : BB:BB:BB:BB:BB:BB │ ← 自分（PC_B）
│  ├─ 送信元IP          : 192.168.1.20      │ ← 自分（PC_B）
│  ├─ 宛先MAC           : AA:AA:AA:AA:AA:AA │ ← 相手（PC_A）
│  └─ 宛先IP            : 192.168.1.10      │ ← 相手（PC_A）
└───────────────────────────────────────────┘
